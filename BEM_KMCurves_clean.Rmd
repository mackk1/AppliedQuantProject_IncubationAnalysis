---
title: "KM Log Rank"
author: "Kevin Mack"
date: "Tuesday, January 19, 2016"
output: html_document
---
```{r, echo=F}
KM_Survival <- read.csv("~/Applied Quant Project/Trial1_survival.csv")
library(survival)

#loop for sites
sites = unique(KM_Survival$Site)
mod_sites = list()
for(i in seq_along(sites)) {
  mod_sites[[i]] = survfit(Surv(Duration[Site == sites[i]], Status[Site == sites[i]]) ~ 1, data=KM_Survival)
}

#loop for region
region = unique(KM_Survival$Region)
mod_region = list()
for(i in seq_along(region)) {
  mod_region[[i]] = survfit(Surv(Duration[Region == region[i]], Status[Region == region[i]] ~ 1, data = KM_Survival))
}

#loop for sex
sex = unique(KM_Survival$Sex)
mod_sex = list()
for(i in seq_along(sex)) {
  mod_sex[[i]] = survfit(Surv(Duration[Sex == sex[i]], Status[Sex == sex[i]] ~ 1, data = KM_Survival))
}
```


```{r, echo=F}
#LETHAL FIGS
palette(c('dodgerblue3','dodgerblue3', 'deepskyblue1', 'deepskyblue1', 'red', 'red', 'firebrick4', 'firebrick4'))
plot(mod_sites[[1]],conf.int='none', xlab ='Time (hours)', ylab = 'Survival Probability')
for(i in seq_along(mod_sites))
  lines(mod_sites[[i]],conf.int='none', col = i) 
legend(x='bottomleft',c('Baruch', 'Charleston','Bluffton','Savannah'), col=c('dodgerblue3', 'deepskyblue1','red', 'firebrick4'),lwd=3, lty=c(1,1,1,1))

colors = c('dodgerblue3', 'deepskyblue1','red', 'firebrick4')

lines(mod_sites[[2]],conf.int='none', col = 'dodgerblue3', lwd=3)
lines(mod_sites[[3]],conf.int='none', col = 'deepskyblue1', lwd=3)
lines(mod_sites[[4]],conf.int='none', col = 'deepskyblue1', lwd=3)
lines(mod_sites[[5]],conf.int='none', col = 'red', lwd=3)
lines(mod_sites[[6]],conf.int='none', col = 'red', lwd=3)
lines(mod_sites[[7]],conf.int='none', col = 'firebrick4', lwd=3)
lines(mod_sites[[8]],conf.int='none', col = 'firebrick4', lwd=3)
legend(x='bottomleft',c('Baruch', 'Charleston','Bluffton','Savannah'), col=c('dodgerblue3', 'deepskyblue1','red', 'firebrick4'),lwd=3, lty=c(1,1,1,1), cex=1.5)

plot(mod_sites[[1]],conf.int='none', col = 'dodgerblue3', lwd=3, cex.axis=1.5, xlab ='Time (hours)', ylab = 'Survival Probability', cex.lab=2)
(for(i in seq_along(mod_sites)) {
  lines(mod_sites[[i]], conf.int='none', col= c('red','green','blue','black'),lwd=3)
})




#SITE
par(pin=c(8.44,5.93), mai=c(1.3,1.3,1.5,0.4), oma=c(0,0,0,0))
plot(bc,conf.int='none', col = 'dodgerblue3', lwd=3, lty=c(1), cex.axis=1.5, xlab ='Time (hours)', ylab = 'Survival Probability', cex.lab=2)
mtext("Temperature",3,line=4,at=200, cex=2)
axis(3,days,labels=temps,line=1)
lines(tc,conf.int='none', col = 'dodgerblue3', lwd=3, lty=c(1))
lines(grice,conf.int='none', col = 'deepskyblue1', lwd=3, lty=c(1))
lines(bowens,conf.int='none', col = 'deepskyblue1', lwd=3, lty=c(1))
lines(trask,conf.int='none', col = 'red', lwd=3, lty=c(1))
lines(pinckney,conf.int='none', col = 'red',lwd=3, lty=c(1))
lines(mex,conf.int='none', col = 'firebrick4',lwd=3, lty=c(1))
lines(rh,conf.int='none', col = 'firebrick4',lwd=3, lty=c(1))
legend(x='bottomleft',c('Baruch', 'Charleston','Bluffton','Savannah'), col=c('dodgerblue3', 'deepskyblue1','red', 'firebrick4'),lwd=3, lty=c(1,1,1,1), cex=1.5)

#REGION
plot(north, conf.int='none', col='dodgerblue3', lwd=3, lty=c(1),cex.axis=1.5, xlab='Time (hours)', ylab = 'Survival Probability', cex.lab=2)
mtext("Temperature",3,line=4,at=200, cex=2)
axis(3,days, labels=temps,line=1)
lines(south,conf.int='none', col='firebrick4', lwd=3, lty=c(1) )
legend(x='bottomleft',c('North', 'South'),col= c('dodgerblue3','firebrick4'),lwd=3,lty=c(1,1),cex=1.5)

#SEX
 plot(male,conf.int='none', col = 'black', lty=c(3), lwd=3, cex.axis=1.5, xlab =
'Time (hours)', ylab = 'Survival Probability', cex.lab=2)
mtext("Temperature",3,line=4,at=200, cex=2)
axis(3,days, labels=temps,line=1)
lines(female,conf.int='none', col = 'black', lwd=3, lty=c(1))
legend(x='bottomleft',c('Females', 'Males'),col='black',lwd=3,lty=c(1,3), cex=1.5)

#sexes by Region
north_sex=survfit(Surv(Duration, Status)~Sex, data=North)
south_sex=survfit(Surv(Duration, Status)~Sex, data=South)
plot(north_sex, col= c('dodgerblue3'), lty=c(1,3), lwd=2, cex.axis=1.25, xlab='Time (hours)', ylab = 'Survival Probability', cex.lab=1.4)
mtext("Temperature",3,line=4,at=200, cex=1.4)
axis(3,days, labels=temps,line=1)
lines(south_sex, col= c('darkolivegreen'), lty=c(1,3), lwd=2)
legend(x='bottomleft',c('North: Female', 'North: Male', 'South: Female', 'South: Male'),col= c('goldenrod3', 'goldenrod3', 'darkolivegreen', 'darkolivegreen'),lwd=2,lty=c(1,3,1,3))

#Size
par(pin=c(8.44,5.93), mai=c(1.3,1.3,0.4,0.4), oma=c(0,0,0,0))
plot(CW~Duration, data = Male, cex.axis=1.25, xlab='Time (hours)', ylab = 'Carapace Width (mm)', cex.lab=1.4 )
abline(lm(CW~Duration, data=Male), , lty=c(3), lwd=2)
points(CW~Duration, data=Female, pch=19)
abline(lm(CW~Duration, data=Female), , lty=c(1), lwd=2)
legend(x='bottomleft',c('Female', 'Male'),lwd=2,lty=c(1,3),pch=c(19,1))
```







ANALYSIS FIGS

```{r}
#All Blocks by Region
plot(north, conf.int='none', col='red', lty=c(1), xlab='Time (hours)', ylab = 'Survival Probability')
lines(south,conf.int='none', col='green', lty=c(1) )
title(main='KM-Curves: Region')
legend(x='bottomleft',c('North', 'South'),col= c('red','green'),lwd=1,lty=c(1))

#Females by Region
plot(survfit(Surv(Duration, Status)~Region, data=Female), col= c('red','green'), lty=c(1), xlab='Time (hours)', ylab = 'Survival Probability')
title(main='KM-Curves: Females')
legend(x='bottomleft',c('North', 'South'),col= c('red','green'),lwd=1,lty=c(1))
tapply(Female$Duration, Female$Region, mean )

#Males by Region
plot(survfit(Surv(Duration, Status)~Region, data=Male), col= c('red','green'), lty=c(1), xlab='Time (hours)', ylab = 'Survival Probability')
title(main='KM-Curves: Males')
legend(x='bottomleft',c('North', 'South'),col= c('red','green'),lwd=1,lty=c(1))
tapply(Female$Duration, Female$Region, mean )


#sexes by Region
plot(survfit(Surv(Duration, Status)~Region+Sex, data=KM_Survival), col= c('red','green'), lty=c(1), xlab='Time (hours)', ylab = 'Survival Probability')
title(main='KM-Curves: Females')
legend(x='bottomleft',c('North', 'South'),col= c('red','green'),lwd=1,lty=c(1))
tapply(Female$Duration, Female$Region, mean )

```







```{r}
#Plotting Survivor Curves
#All Blocks by Sex
 plot(male,conf.int='none', col = 'black', lty=c(1), xlab =
'Time (hours)', ylab = 'Survival Probability')
lines(female,conf.int='none', col = 'black', lty=c(2))
title(main='KM-Curves: Sex')
legend(x='bottomleft',c('Females', 'Males'),col='black',lwd=1,lty=c(2,1))

#All Blocks by Site
 plot(bc,conf.int='none', col = 'red3', xlab ='Time (hours)', ylab = 'Survival Probability')
lines(tc,conf.int='none', col = 'red3')
lines(grice,conf.int='none', col = 'red')
lines(bowens,conf.int='none', col = 'red')
lines(trask,conf.int='none', col = 'green3')
lines(pinckney,conf.int='none', col = 'green3')
lines(mex,conf.int='none', col = 'green')
lines(rh,conf.int='none', col = 'green')
title(main='KM-Curves: Site')
legend(x='bottomleft',c('Bly Creek', 'Town Creek','Grice','Bowens Island','Trask','Pinckney','Extension Office','Roebling House'),col=c('red3','red3','red','red','green3','green3','green','green'),lwd=1, lty=c(1))

```

```{r}
#Further examination
#All Blocks, All Sites, Females
plot(survfit(Surv(Duration,Status)~Site, data=Female)) #like this but pretty

plot(bc_f,conf.int='none', col='blue', lty=c(2), lwd=2, xlab ='Time (hours)', ylab = 'Survival Probability')
lines(tc_f,conf.int='none', col = 'blue', lty=c(2), lwd=2)
lines(grice_f,conf.int='none', col = 'red', lty=c(2), lwd=2)
lines(bowens_f,conf.int='none', col = 'red', lty=c(2), lwd=2)
lines(trask_f,conf.int='none', col = 'darkgreen', lty=c(2), lwd=2)
lines(pinckney_f,conf.int='none', col = 'darkgreen', lty=c(2), lwd=2)
lines(mex_f,conf.int='none', col = 'darkorange4', lty=c(2), lwd=2)
lines(rh_f,conf.int='none', col = 'darkorange4', lty=c(2), lwd=2)
title(main='KM-Curves: All Sites, Females')
legend(x='bottomleft',c('Bly Creek', 'Town Creek','Grice','Bowens Island','Trask','Pinckney','Extension Office','Roebling House'),col=c('blue','blue','red','red','darkgreen','darkgreen','darkorange4','darkorange4'),lwd=2, lty=c(2))

#All Blocks, All Sites, Males
plot(survfit(Surv(Duration,Status)~Site, data=Male)) # like this but pretty

plot(bc_m,conf.int='none', col='blue', lty=c(1), lwd=2, xlab ='Time (hours)', ylab = 'Survival Probability')
lines(tc_m,conf.int='none', col = 'blue', lty=c(1), lwd=2)
lines(grice_m,conf.int='none', col = 'red', lty=c(1), lwd=2)
lines(bowens_m,conf.int='none', col = 'red', lty=c(1), lwd=2)
lines(trask_m,conf.int='none', col = 'darkgreen', lty=c(1), lwd=2)
lines(pinckney_m,conf.int='none', col = 'darkgreen', lty=c(1), lwd=2)
lines(mex_m,conf.int='none', col = 'darkorange4', lty=c(1), lwd=2)
lines(rh_m,conf.int='none', col = 'darkorange4', lty=c(1), lwd=2)
title(main='KM-Curves: All Sites, Males')
legend(x='bottomleft',c('Bly Creek', 'Town Creek','Grice','Bowens Island','Trask','Pinckney','Extension Office','Roebling House'),col=c('blue','blue','red','red','darkgreen','darkgreen','darkorange4','darkorange4'),lwd=2, lty=c(1))

```


```{r}
# Further breakdown of each sex at each site individually
# Bly Creek, By Sex
plot(survfit(Surv(Duration,Status)~Sex, data=BlyCreek), col='blue', lty=c(2,1), lwd=c(2,1),xlab ='Time (hours)', ylab = 'Survival Probability')
title(main='KM-Curves: Bly Creek, Sex')
legend(x='bottomleft',c('Females', 'Males'),col='blue',lwd=1,lty=c(2,1))

#Town Creek, By Sex
plot(survfit(Surv(Duration,Status)~Sex, data=TownCreek), col='blue', lty=c(2,1), lwd=c(2,1),xlab ='Time (hours)', ylab = 'Survival Probability')
title(main='KM-Curves: Town Creek, Sex')
legend(x='bottomleft',c('Females', 'Males'),col='blue',lwd=1,lty=c(2,1))

#Grice, By Sex
plot(survfit(Surv(Duration,Status)~Sex, data=Grice), col='red', lty=c(2,1), lwd=c(2,1),xlab ='Time (hours)', ylab = 'Survival Probability')
title(main='KM-Curves: Grice, Sex')
legend(x='bottomleft',c('Females', 'Males'),col='red',lwd=1,lty=c(2,1))

#Bowens, By Sex
plot(survfit(Surv(Duration,Status)~Sex, data=Bowens), col='red', lty=c(2,1), lwd=c(2,1),xlab ='Time (hours)', ylab = 'Survival Probability')
title(main='KM-Curves: Bowens Island, Sex')
legend(x='bottomleft',c('Females', 'Males'),col='red',lwd=1,lty=c(2,1))

#Pinckney, By Sex
plot(survfit(Surv(Duration,Status)~Sex, data=Pinckney), col='darkgreen', lty=c(2,1), lwd=c(2,1),xlab ='Time (hours)', ylab = 'Survival Probability')
title(main='KM-Curves: Pinckney, Sex')
legend(x='bottomleft',c('Females', 'Males'),col='darkgreen',lwd=1,lty=c(2,1))

#Trask, By Sex
plot(survfit(Surv(Duration,Status)~Sex, data=Trask), col='darkgreen', lty=c(2,1), lwd=c(2,1),xlab ='Time (hours)', ylab = 'Survival Probability')
title(main='KM-Curves: Trask, Sex')
legend(x='bottomleft',c('Females', 'Males'),col='darkgreen',lwd=1,lty=c(2,1))

#Extension Office, By Sex
plot(survfit(Surv(Duration,Status)~Sex, data=ExOffice), col='darkorange4', lty=c(2,1), lwd=c(2,1),xlab ='Time (hours)', ylab = 'Survival Probability')
title(main='KM-Curves: Extension Office, Sex')
legend(x='bottomleft',c('Females', 'Males'),col='darkorange4',lwd=1,lty=c(2,1))

#Roebling House, By Sex
plot(survfit(Surv(Duration,Status)~Sex, data=RobHouse), col='darkorange4', lty=c(2,1), lwd=c(2,1),xlab ='Time (hours)', ylab = 'Survival Probability')
title(main='KM-Curves: Roebling House, Sex')
legend(x='bottomleft',c('Females', 'Males'),col='darkorange4',lwd=1,lty=c(2,1))
```































